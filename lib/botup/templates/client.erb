module <%= class_name %>
  class Client
    attr_reader :token

    def initialize(token)
      @token = token
    end

    def start
      begin
        Telegram::Bot::Client.run(token) do |bot|
          bot.listen do |message|
            if message.text
              messenger = Messenger.new(api: bot.api, chat_id: message.chat.id)
              response = CommandsManager.new(message: message, messenger: messenger).call
              messenger.send_text(response)
            end
          end
        end
      rescue Telegram::Bot::Exceptions::ResponseError => e
        puts e
        sleep 1
        retry # run again on telegram server error
      end
    end
  end
end
